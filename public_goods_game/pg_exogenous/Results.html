{{ block title }}Round {{ player.round_number }} Results{{ endblock }}


{{ block content }}
{{ include "pg_exogenous/_scorebar.html" }}


<style>
   .wrap {
       max-width: 860px;
       margin: 0 auto;
   }


   .topline {
       display: flex;
       justify-content: space-between;
       align-items: center;
       margin-bottom: 12px;
       opacity: 0.85;
   }


   .pill {
       display: inline-block;
       padding: 3px 10px;
       border: 1px solid #ddd;
       border-radius: 999px;
       font-size: 12px;
       background: #fff;
   }


   .grid {
       display: grid;
       grid-template-columns: 1fr 1fr;
       gap: 12px;
       margin: 12px 0;
   }


   @media (max-width: 820px) {
       .grid {
           grid-template-columns: 1fr;
       }
   }


   .card {
       border: 1px solid #ddd;
       border-radius: 16px;
       background: #fff;
       padding: 14px;
   }


   .big {
       font-size: 34px;
       font-weight: 900;
       line-height: 1;
       margin-top: 6px;
   }


   .sub {
       opacity: 0.75;
       margin-top: 4px;
       font-size: 13px;
       line-height: 1.35;
   }


   .row {
       display: flex;
       justify-content: space-between;
       padding: 10px 0;
       border-bottom: 1px solid #eee;
   }


   .row:last-child {
       border-bottom: none;
   }


   .label {
       font-weight: 700;
   }


   .val {
       font-weight: 800;
   }


   .bar {
       height: 10px;
       background: #eee;
       border-radius: 999px;
       overflow: hidden;
       margin-top: 8px;
   }


   .fill {
       height: 100%;
       width: 0%;
       background: #333;
   }


   .callout {
       border: 1px solid #e6e6e6;
       background: #fafafa;
       border-radius: 16px;
       padding: 14px;
       margin-top: 12px;
   }


   .clean-btn {
       margin-top: 14px;
   }
</style>


<div class="wrap">


   <div class="topline">
       <div class="pill">Firm size: {{ firm_size }}</div>
       <div class="pill">Endowment: {{ C.ENDOWMENT }} effort</div>
   </div>


   <div class="grid">
       <!-- Total payoff -->
       <div class="card">
           <div style="display:flex; justify-content:space-between; align-items:flex-start;">
               <div>
                   <div style="font-weight:800;">Your total payoff</div>
                   <div class="sub">This includes what you kept for yourself + your share of the firm payout.</div>
               </div>
               <div class="pill">points</div>
           </div>
           <div class="big">{{ total_payoff }}</div>


           <div class="bar" aria-hidden="true">
               <!-- purely visual "earned" bar: percent of a soft max -->
               <div class="fill" id="payFill"></div>
           </div>
           <div class="sub">You automatically move to the next screen after reviewing.</div>
       </div>


       <!-- Your decision breakdown -->
       <div class="card">
           <div style="font-weight:800;">Your decision</div>


           <div class="row">
               <div class="label">You put into the firm</div>
               <div class="val">{{ effort_to_firm }}</div>
           </div>


           <div class="row">
               <div class="label">You kept for yourself</div>
               <div class="val">{{ effort_kept }}</div>
           </div>


           <div class="row">
               <div class="label">Self payoff (guaranteed)</div>
               <div class="val">{{ selfish_payoff }} pts</div>
           </div>


           <div class="sub">
               Putting effort into the firm can help the group’s payout — but it also costs you 1 point per unit you
               give up.
           </div>
       </div>
   </div>


   <!-- Firm outcome -->
   <div class="card">
       <div style="display:flex; justify-content:space-between; align-items:center;">
           <div style="font-weight:900;">How your firm performed</div>
           <div class="pill">shared equally</div>
       </div>


       <div class="row">
           <div class="label">Total firm effort (all members)</div>
           <div class="val">{{ total_firm_effort }}</div>
       </div>


       <div class="row">
           <div class="label">Firm payout per person</div>
           <div class="val">{{ per_capita_payout }} pts</div>
       </div>


       <div class="callout">
           <div style="font-weight:900; margin-bottom:6px;">
               What this means
           </div>
           <div class="sub" style="font-size:14px;">
               When your firm’s total effort is higher, the payout per person tends to be higher.
               If your firm didn’t put in much effort, the firm payout will be smaller — even if you personally kept a
               lot.
           </div>
       </div>


       <div class="callout">
           <div class="row" style="border-bottom:none; padding: 6px 0;">
               <div class="label">Your personal “cost” of contributing</div>
               <div class="val">{{ personal_cost }} pts</div>
           </div>
           <div class="sub">
               This is how many points you gave up by contributing to the firm instead of keeping that effort for
               yourself.
               (Your share of the firm payout can make that worth it — or not — depending on what everyone did.)
           </div>
       </div>
   </div>




</div>


{{ endblock }}


{{ block scripts }}
<script>
   // Soft progress bar: scales payoff against a reasonable max
   // max-ish = endowment + (2.5 * endowment) (approx upper bound per-capita payout)
   const payoff = Number("{{ total_payoff }}");
   const softMax = Number("{{ C.ENDOWMENT }}") + 2.5 * Number("{{ C.ENDOWMENT }}");
   const pct = Math.max(0, Math.min(100, (payoff / softMax) * 100));
   const fill = document.getElementById('payFill');
   if (fill) fill.style.width = pct + "%";
</script>
{{ endblock }}

